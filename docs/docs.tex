\documentclass[letterpaper]{article}

\usepackage[utf8]{inputenc}
\usepackage[margin=1in]{geometry}
\usepackage{listings}
\usepackage[hidelinks]{hyperref}

\hypersetup{colorlinks, allcolors=blue}
\lstset {%
    breaklines=true,
    postbreak=\mbox{\textcolor{red}{$\hookrightarrow$}\space},
    basicstyle=\ttfamily,
    numbers=left,
    numberstyle=\normalsize,
    numbersep=10pt,
    frame=single,
}
\setlength\parindent{0pt}

\begin{document}

\pagenumbering{gobble}
\vspace*{\fill}
\begin{center}
    \Large
    Documentation for Financial Transactions Web Application

    \large
    Jason N.

    June 1, 2020
\end{center}
\vspace*{\fill}

\newpage
\pagenumbering{roman}
\tableofcontents

\newpage
\pagenumbering{arabic}
\parskip 10pt

\section{Disclaimer}

This project is meant solely as a proof of concept to demonstrate how different databases might be used in this context.
The project is NOT meant to be used in production.
Several security flaws are present, including SQL injection, possible XSS, lack of authentication, etc.

\section{Setup}

This section is meant to serve as a general guide for setting up integrations used in this project.
The detail in this guide is limited as the process will depend heavily on your choices, which I have attempted to outline for you.
Many materials are referenced in this guide which contain far more detail, I would strongly suggest reading through these if they apply to your setup.

\subsection{Google API}

This is required for interacting with the Google Sheets database.

\subsection{Firebase}

Firebase is used to host the web application and two of the databases, as well as storing images for all other databases to reference.
All features are available through the same firebase project.

To get started, simply navigate to https://console.firebase.google.com and click "Add Project".
Follow the instructions to set the name of the project and decide whether or not you want to make use of analytics.

Once a project has been created, follow the instructions at https://firebase.google.com/docs/web/setup to set up firebase with the front-end application.
If you are using the files in this repository, the necessary SDKs are already included, though you'll need to change the firebase config to the appropriate values for your project.

To set up the real-time database, follow the instructions at https://firebase.google.com/docs/database/web/start to create a database and get your real-time database url.
If you're using files from this repository, modify the firebase config to use this url instead of the given one.

To set up firestore, follow the instructions at https://firebase.google.com/docs/firestore/quickstart to create a database.
If you're using files from this repository, modify the contents of the object passed to the firebase.initializeApp() method to use appropriate values for your project.
This method is called in the public/firebaseScript.js file.

To set up cloud functions, follow the instructions at https://firebase.google.com/docs/functions/get-started.
If you're using files from this repository, the files already exist and just need to be deployed.

\subsection{MySQL}

There are several different implementations of MySQL available.
MariaDB was used to create and test this project, which is a fork of MySQL.

If you decide to host the database yourself, you'll need to start the program, log in, and create a database.
In this repository, it is named `mydb', however, this can be changed if desired.

If you wish to use this repository, the database can be imported using the dump.txt file.

\lstinline{mysql -u username -p database_name < dump.txt}

Otherwise, once the database is created, enter the database using `use database name;' to enter the database.

\newpage

\section{HTML}\label{HTML}

\subsection{Preamble and head}

\subsubsection{Preamble}

Declares the document as HTML5.
\begin{lstlisting}[firstnumber=1]
<!DOCTYPE html>
\end{lstlisting}

\subsubsection{meta charset}

Specifies that characters in the file are encoded in UTF-8.
\begin{lstlisting}[firstnumber=4]
<meta charset = "UTF-8"/>
\end{lstlisting}

\subsubsection{link rel="stylesheet"}

Imports the CSS file.
\begin{lstlisting}[firstnumber=5]
<link rel="stylesheet" type="text/css" href="./style.css"/>
\end{lstlisting}

\subsubsection{Scripts}

Imports the main Javascript file, responsible for the table and UI.
\begin{lstlisting}[firstnumber=7]
<script src="./script.js"></script>
\end{lstlisting}

Imports the Google API library.
\begin{lstlisting}[firstnumber=8]
<script src="https://apis.google.com/js/api.js"></script>
\end{lstlisting}

Imports other Javascript files, responsible for database management.
\begin{lstlisting}[firstnumber=9]
<script src="./googleApiScript.js"></script>
<script src="./mysqlScript.js"></script>
<script src="./localStorageScript.js"></script>
<script src="./imageFirestore.js"></script>
\end{lstlisting}

\subsection{Inputs}

Disables autocomplete which remembers past user input by default. \lstinline{return false} specifies that no \lstinline{POST} request should be made to the server.
\begin{lstlisting}[firstnumber=20]
<form onsubmit="return false" autocomplete="off">
\end{lstlisting}

\subsubsection{Labels}

Identifies the purpose of the field to the user, allows the user to select the field by clicking the label.
This element is also used by accessibility tools to identify the field.
\begin{lstlisting}[firstnumber=22]
<label for="date">Date:</label><br/>
\end{lstlisting}

\subsubsection{Date}

The \lstinline{date} input type is supported by most modern browsers and provides an intuitive UI for selecting dates.
It also includes methods for converting or verifying the \lstinline{Date} object.
\begin{lstlisting}[firstnumber=13]
<input id="date" name="date" type="date" placeholder="yyyy-mm-dd"/>
\end{lstlisting}

\subsubsection{Text}

The \lstinline{text} input type allows the user to input a string. For numbers, this string has to be parsed in Javascript.
\begin{lstlisting}[firstnumber=28]
<input id="account" name="account" list="accountsList" type="text" placeholder="Account Number"/>
\end{lstlisting}

\subsubsection{List}

Lists are created using the \lstinline{select} element, containing \lstinline{option} elements.
Each option has a \lstinline{value} which is used in Javascript, and \lstinline{innerText} which is seen by the user.
\begin{lstlisting}[firstnumber=34]
<label for="type">Transaction Type:</label><br/>
<select id="type" name="type">
    <option value=""></option>
    <option value="BUY">BUY</option>
    <option value="SELL">SELL</option>
    <option value="!DIVIDEND">DIVIDEND</option>
    <option value="!INTEREST">INTEREST</option>
    <option value="!WITHDRAW">WITHDRAW</option>
    <option value="!DEPOSIT">DEPOSIT</option>
</select>
\end{lstlisting}

\subsubsection{File}

Files are uploaded using the \lstinline{file} input type.
The \lstinline{multiple} attribute allows the user to upload multiple files, which are interpreted as an array of files in Javascript.
\begin{lstlisting}[firstnumber=64]
    <label id="fileUploadLabel" for="fileUpload">Upload file</label>
    <input id="fileUpload" name="fileUpload" type="file" onchange="fileUploadChanged();" multiple/>
\end{lstlisting}

\subsubsection{Buttons}

Buttons with the \lstinline{submit} type can be used to check that all required sections are complete and highlight them in red.
These buttons can also be used to send a \lstinline{POST} request to a server if desired.
The \lstinline{onclick} attribute specified the function and parameters that should be executed when pressed.
\begin{lstlisting}[firstnumber=70]
<button id="add" type="submit" onclick="addTransactionButton();">Add Transaction</button>
\end{lstlisting}

\subsection{Filters}

Filter HTML elements are handled exactly the same as their counterparts in the input section.
Some fields have two elements to handle a lower and upper bound, but these are handled solely in Javascript.

\subsubsection{Tooltip}

The \lstinline{span} element is a generic container.
The \lstinline{title} attribute will display its value as a tool tip when the element is hovered.
\begin{lstlisting}[firstnumber=118]
<span title="Enter search terms here. Separate search terms with && or || for AND and OR statements, respectively. Exclusive filters are marked by a leading !. Use || to filter by multiple securities (e.g. SPY || TLT) and && to exclude multiple securities (e.g. !SPY && !TLT).">?</span><br/>
\end{lstlisting}

\subsubsection{Checkbox}

The input type \lstinline{checkbox} provides a toggleable input field which can be evaluated as \lstinline{true} or \lstinline{false} with Javascript.
\begin{lstlisting}[firstnumber=153]
<label for="filterNa">Filter N/A:</label>
<input id="filterNA" name="filterNA" type="checkbox"/>
\end{lstlisting}

\subsection{Options}

The options section uses buttons, text inputs, a file input, and drop down menus, which are decribed in the inputs section.
The special handling of these elements is done in Javascript.

\subsection{Table}

\subsection{frozenColumns}

Cells in columns that are meant to be always visible are marked with a \lstinline{frozenColumnx} class, where \lstinline{x} is the column number.
CSS is used to keep the column in place when scrolling.
\begin{lstlisting}[firstnumber=233]
<th class="frozenColumn1">
    <section>
        Transaction ID
    </section>
\end{lstlisting}

\subsection{sort buttons}

Sorting is done using buttons with an \lstinline{onclick} attribute that calls a function \lstinline{sortTable()}.
The parameters passed are the column index and a boolean value indicating whether the column should be sorted in ascending or descending order.
\begin{lstlisting}[firstnumber=237]
<section class="sort">
    <button type="button" onclick="sortTable(0, true)">^</button>
    <button type="button" onclick="sortTable(0, false)">v</button>
</section>
\end{lstlisting}

\subsubsection{tbody}

The main table body is initially empty.
Rows are managed by Javascript and it is marked with a unique id for this purpose.
\begin{lstlisting}[firstnumber=317]
<tbody id="tableBody">
</tbody>
\end{lstlisting}

\subsection{Firebase scripts}

These scripts are taken directly from the firebase documentation.
They are required for firebase and its components to function.
The \lstinline{firebase-app.js} script is the main script and is required for all firebase features.
The next three scripts are required for collecting analytics data, the realtime database, and firestore, respectively.

The configuration contains API keys and project information required to identify the app.
The key is not secret, though it is unique to the project.
As it is easily obtained by users of the app, it is strongly recommended to whitelist your domain in the project settings.

Unlike the other scripts, the firebase script is declared at the bottom, as it requires that the SDKs have loaded first.
\begin{lstlisting}[firstnumber=323]
<!-- The core Firebase JS SDK is always required and must be listed first -->
<script src="https://www.gstatic.com/firebasejs/7.14.2/firebase-app.js"></script>

<script src="https://www.gstatic.com/firebasejs/7.14.2/firebase-analytics.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.14.2/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.14.3/firebase-firestore.js"></script>

<script>
// Your web app's Firebase configuration
var firebaseConfig = {
    apiKey: "AIzaSyAmZLFZHDAB9evhvNunxOe5GxXRd_OizmU",
    authDomain: "financial-transactions-6f065.firebaseapp.com",
    databaseURL: "https://financial-transactions-6f065.firebaseio.com",
    projectId: "financial-transactions-6f065",
    storageBucket: "financial-transactions-6f065.appspot.com",
    messagingSenderId: "82206982479",
    appId: "1:82206982479:web:8937bbd1bd4fb6022b053a",
    measurementId: "G-0564DT8RNQ"
};
// Initialize Firebase
firebase.initializeApp(firebaseConfig);
firebase.analytics();

var database = firebase.database();
var firestore = firebase.firestore();
</script>

<script src="./firebaseScript.js"></script>
\end{lstlisting}

\newpage

\section{Main Javascript}\label{JS}
\subsection{formattedStringToNumber()}
\subsection{numberToFormattedString()}
\subsection{getData()}
\subsection{validate()}
\subsubsection{Check empty}
\subsubsection{Check NaN}
\subsubsection{Check date}
\subsection{generateId()}
\subsection{calculateCostBasis()}
\subsection{addTransaction()}
\subsection{fileIdGenerator()}
\subsection{addTransactionButton()}
\subsection{addTransactionWithFileName()}
\subsection{deleteRow()}
\subsection{editRow()}
\subsection{saveChanges()}
\subsection{discardChanges()}
\subsection{sortTable()}
\subsection{resetDate()}
\subsection{validateFilters()}
\subsubsection{always true}
\subsubsection{date range}
\subsubsection{amount range}
\subsubsection{generic ranges}
\subsection{stringFilter()}
\subsection{applyFilter()}
\subsection{clearFilter()}
\subsection{unfilterAll()}
\subsection{toggleID()}
\subsection{readFile()}
\subsection{saveFile()}
\subsection{applyTypes()}
\subsection{editTypes()}
\subsection{toggleSection()}
\subsection{loadDataLists()}
\subsection{readCurrentTypes()}
\subsection{tableToArrays()}
\subsection{arraysToTable()}
\subsection{window.onload = function()}

\newpage

\section{firebaseScript.js}

\subsection{clearFirebase()}
\subsection{writeToFirebase()}
\subsection{readFromFirebase()}
\subsection{clearFirestore()}
\subsection{writeToFirestore()}
\subsection{readFromFirestore()}

\newpage

\section{googleApiScript.js}

\subsection{Global Variables}
\subsection{loadSheetData()}
\subsection{getNewSheetData()}
\subsection{populateSheetSelector()}
\subsection{getNewTabData()}
\subsection{populateTabSelector()}
\subsection{getAllUserSheets()}
\subsection{getTabsOfSheet()}
\subsection{authenticate()}
\subsection{loadClientSheets()}
\subsection{loadClient()}
\subsection{readGoogleSheetDB()}
\subsection{readGoogleTypes()}
\subsection{writeGoogleSheetDB()}
\subsection{setGoogleRows()}
\subsection{clearGoogleRow()}
\subsection{writeGoogleDB()}
\subsection{gapi.load()}

\newpage

\section{imageFirestore.js}

\subsection{writeImagesToFirestore()}
\subsection{readImagesFromFirestore()}
\subsection{getFileNamesIds()}
\subsection{parseFileNamesIds()}
\subsection{clearIndexedDb()}

\newpage

\section{localStorageScript.js}

\subsection{Global Variables}
\subsection{initDb()}
\subsection{fileUploadChanged()}
\subsection{uploadFile()}
\subsection{addFile()}
\subsection{updateExistingFileName()}
\subsection{removeFileFromTable()}
\subsection{deleteFileFromIndexedDB()}
\subsection{removeFileUpload()}
\subsection{downloadFile()}
\subsection{window.onbeforeunload = function()}

\newpage

\section{mysqlScript.js}

\subsection{writeToMySQL()}
\subsection{readFromMySQL()}

\newpage

\section{CSS}\label{CSS}

\subsection{Vertical Scrolling Table}
\subsection{Horizontal Scrolling on Overflow}\label{overflow-x}
\subsection{Miscellaneous}
\subsubsection{Sort buttons}
\subsubsection{Editing highlight}
\subsubsection{Table borders}

%\newpage
%
%\appendix
%\section{HTML Source Code}
%\lstinputlisting{../release/public/index.html}
%\newpage
%
%\section{Javascript Source Code}
%\subsection{Main Script}
%\lstinputlisting{../release/public/script.js}
%\newpage
%\subsection{Google API Script}
%\lstinputlisting{../release/public/googleApiScript.js}
%\newpage
%\subsection{Firebase Script}
%\lstinputlisting{../release/public/firebaseScript.js}
%\newpage
%\subsection{MySQL Script}
%\lstinputlisting{../release/public/mysqlScript.js}
%\newpage
%\subsection{Local Storage Script}
%\lstinputlisting{../release/public/localStorageScript.js}
%\newpage
%\subsection{Firestore Images Script}
%\lstinputlisting{../release/public/imageFirestore.js}
%\newpage
%
%\section{CSS Source Code}
%\lstinputlisting{../release/public/style.css}
%\newpage
%
%\section{Server-side NodeJs Code}
%\lstinputlisting{../release/functions/index.js}

\end{document}

